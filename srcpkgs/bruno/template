# Template file for 'bruno'
pkgname=bruno
version=2.2.0
revision=1
archs="x86_64"
hostmakedepends="n python3 python3-distutils-extra"
short_desc="Fast and Git-Friendly Opensource API client"
maintainer="Fabien JUIF <fabien.juif@gmail.com>"
license="MIT"
homepage="https://www.usebruno.com/"
changelog="https://www.usebruno.com/changelog"
distfiles="https://github.com/usebruno/bruno/archive/refs/tags/v${version}.tar.gz"
checksum=ebb96d34076b87cc755c4577b7e666177d53337581075bb8e33e50d53bd8dd56

do_build() {
	# using node 20
	n 20

	# dependencies
	npm run setup

	# node gyp dependencies
	npm install node-addon-api

	# actual bruno
	npm run build:web
	npm run build:electron
}

do_install() {
	local package_location="usr/lib/$pkgname"

	vlicense license.md

	vmkdir ${package_location}
	vcopy packages/bruno-electron/out/linux-unpacked/* ${package_location}

	vinstall ${FILESDIR}/bruno.desktop 644 usr/share/applications
	vinstall assets/images/logo.png 644 usr/share/pixmaps bruno.png

	vmkdir usr/bin
	ln -sfr $DESTDIR/${package_location}/bruno $DESTDIR/usr/bin/bruno
}
